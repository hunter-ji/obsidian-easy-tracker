(function(a){if("object"==typeof module&&"object"==typeof module.exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else{const b="undefined"==typeof globalThis?window:globalThis;b.CalendarHeatmap=a()}})(function(){var a=Math.max,b=Number.isNaN;function c(a){const b=((a||"en")+"").toLowerCase(),c=v[b]||b;return u[c]||u.en}function d(a){if(!a)throw new Error("CalendarHeatmap: container is required.");if("string"==typeof a){const b=document.querySelector(a);if(!b)throw new Error(`CalendarHeatmap: container selector "${a}" not found.`);return b}return a}function e(){if("undefined"!=typeof document&&!document.getElementById(s)){const a=document.createElement("style");a.id=s,a.textContent=[".ch-root { font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; --ch-size: 14px; --ch-gap: 2px; }",".ch-grid { display: grid; grid-auto-flow: column; grid-auto-columns: max-content; column-gap: var(--ch-gap); }",".ch-week { display: grid; grid-template-rows: repeat(7, 1fr); row-gap: var(--ch-gap); }",`.ch-day { width: var(--ch-size); height: var(--ch-size); box-sizing: border-box; border-radius: 2px; background-color: ${r[0]}; position: relative; }`,`.ch-day[data-level="0"] { background-color: ${r[0]}; }`,".ch-tooltip { position: absolute; pointer-events: none; z-index: 9999; padding: 4px 6px; border-radius: 4px; font-size: 12px; background: rgba(17, 24, 39, 0.9); color: #fff; }",".ch-legend { display: flex; align-items: center; gap: 4px; font-size: 12px; margin-top: 8px; color: #555; }",".ch-legend .ch-swatch { display: inline-block; width: var(--ch-size); height: var(--ch-size); border-radius: 2px; }",".ch-labels { display: grid; grid-template-rows: repeat(7, var(--ch-size)); row-gap: var(--ch-gap); margin-right: 6px; font-size: 10px; color: #555; }"].join("\n"),document.head.appendChild(a)}}function f(a){const b=a.getFullYear(),c=(a.getMonth()+1+"").padStart(2,"0"),d=(a.getDate()+"").padStart(2,"0");return`${b}-${c}-${d}`}function g(a){const c=new Map;return Array.isArray(a)?(a.forEach(a=>{if(!a)return;const d=new Date(a.date||a.day||a.dateString);if(b(d.getTime()))return;const e=f(d),g="number"==typeof a.value?a.value:+a.count;b(g)||c.set(e,g)}),c):c}function h(a,b){const c=new Date(a);return c.setDate(a.getDate()+b),c}function i(a,b){const c=new Date(a),d=(c.getDay()-b+7)%7;return c.setDate(c.getDate()-d),c.setHours(0,0,0,0),c}function j(a,b){const c=i(a,b);return h(c,6)}function k(c,d){const e=d.weekStart%7;let f,g;if("year"===c){const a=+d.year;f=new Date(a,0,1),g=new Date(a,11,31)}else if("month"===c){const a=+d.year,b=+d.month;f=new Date(a,b,1),g=new Date(a,b+1,0)}else if("week"===c){const a=d.startDate?new Date(d.startDate):new Date;if(b(a.getTime()))throw new Error("CalendarHeatmap: invalid startDate for week view.");f=i(a,e),g=j(a,e)}else if("recent"===c){const b=a(+d.recentDays||7,1);g=new Date,g.setHours(0,0,0,0),f=h(g,-b+1)}else throw new Error(`CalendarHeatmap: unsupported view "${c}".`);const k=i(f,e),l=j(g,e),m=[];for(let a=new Date(k);a<=l;)m.push(new Date(a)),a=h(a,1);return{start:f,end:g,alignedStart:k,alignedEnd:l,dates:m}}function l(b,c,d){var e=Math.round,f=Math.min,g=Number.isFinite;const h=Array.isArray(d)&&d.length?d:r;if("function"==typeof d){const e=d(b,c);if("string"==typeof e)return{color:e,level:0<b?1:0};if(e&&"object"==typeof e){const c=+e.level,d=g(c)?a(0,f(c,h.length-1)):0<b?1:0;return{color:e.color||h[d]||h[0],level:null==e.level?0<b?1:0:d}}}if(!b||0>=c)return{color:h[0],level:0};const i=h.length-1;if(0>=i)return{color:h[0],level:0<b?1:0};const j=f(b/c,1),k=a(1,e(j*i));return{color:h[k],level:k}}function m(a,b,c){if("undefined"==typeof document)return null;const d=document.createElement("div");d.className="ch-labels";const e=Array.isArray(b.weekdays)&&7===b.weekdays.length?b.weekdays:null,f=e?null:new Intl.DateTimeFormat(c,{weekday:"short"});for(let g=0;7>g;g+=1){const b=(g+a.weekStart)%7,c=e?e[b]:f.format(new Date(2021,7,b+1)),h=document.createElement("span");h.textContent=c,d.appendChild(h)}return d}function n(a,b){if("undefined"==typeof document)return null;const c=Array.isArray(a)&&a.length?a:r,d=document.createElement("div");d.className="ch-legend";const e=document.createElement("span");e.textContent=b.less,d.appendChild(e),c.forEach(a=>{const b=document.createElement("span");b.className="ch-swatch",b.style.backgroundColor=a,d.appendChild(b)});const f=document.createElement("span");return f.textContent=b.more,d.appendChild(f),d}function o(a,b){if("undefined"==typeof document)return;let c=document.createElement("div");c.className="ch-tooltip",c.style.display="none",document.body.appendChild(c);const d=d=>{const e=d.target.closest(".ch-day");return e&&a.contains(e)?void(c.innerHTML=b(e.dataset),c.style.display="block",c.style.left=`${d.pageX+10}px`,c.style.top=`${d.pageY+10}px`):void(c.style.display="none")},e=()=>{c.style.display="none"};return a.addEventListener("mousemove",d),a.addEventListener("mouseleave",e),()=>{a.removeEventListener("mousemove",d),a.removeEventListener("mouseleave",e),c&&c.parentNode&&c.parentNode.removeChild(c),c=null}}function p(a){const b=document.createElement("div");return b.className="ch-week",a.forEach(a=>{b.appendChild(a)}),b}function q(a,b){if("undefined"!=typeof window){const c=()=>{const c=a.clientWidth||a.getBoundingClientRect().width||0;if(c)for(;b.scrollWidth>c-40&&1<b.children.length;){const a=b.firstElementChild;if(!a)break;b.removeChild(a)}};"function"==typeof window.requestAnimationFrame?window.requestAnimationFrame(c):c()}}const r=["#ebedf0","#9be9a8","#40c463","#30a14e","#216e39"],s="calendar-heatmap-style",t={view:"year",year:new Date().getFullYear(),month:new Date().getMonth(),weekStart:0,recentDays:7,squareSize:14,squareGap:2,colorScale:r,maxValue:null,legend:!1,tooltip:!0,locale:void 0,language:"en"},u={en:{locale:"en-US",legend:{less:"Less",more:"More"},weekdays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],tooltip:(a,b)=>`${a} on ${b}`},"zh-cn":{locale:"zh-CN",legend:{less:"\u8F83\u5C11",more:"\u8F83\u591A"},weekdays:["\u5468\u65E5","\u5468\u4E00","\u5468\u4E8C","\u5468\u4E09","\u5468\u56DB","\u5468\u4E94","\u5468\u516D"],tooltip:(a,b)=>`${b}：${a}`},"zh-tw":{locale:"zh-TW",legend:{less:"\u8F03\u5C11",more:"\u8F03\u591A"},weekdays:["\u9031\u65E5","\u9031\u4E00","\u9031\u4E8C","\u9031\u4E09","\u9031\u56DB","\u9031\u4E94","\u9031\u516D"],tooltip:(a,b)=>`${b}：${a}`},ja:{locale:"ja-JP",legend:{less:"\u5C11\u306A\u3044",more:"\u591A\u3044"},weekdays:["\u65E5","\u6708","\u706B","\u6C34","\u6728","\u91D1","\u571F"],tooltip:(a,b)=>`${b}：${a}`},fr:{locale:"fr-FR",legend:{less:"Moins",more:"Plus"},weekdays:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"],tooltip:(a,b)=>`${a} le ${b}`},de:{locale:"de-DE",legend:{less:"Weniger",more:"Mehr"},weekdays:["So","Mo","Di","Mi","Do","Fr","Sa"],tooltip:(a,b)=>`${a} am ${b}`},ko:{locale:"ko-KR",legend:{less:"\uC801\uC74C",more:"\uB9CE\uC74C"},weekdays:["\uC77C","\uC6D4","\uD654","\uC218","\uBAA9","\uAE08","\uD1A0"],tooltip:(a,b)=>`${b} ${a}`},es:{locale:"es-ES",legend:{less:"Menos",more:"M\xE1s"},weekdays:["Dom","Lun","Mar","Mi\xE9","Jue","Vie","S\xE1b"],tooltip:(a,b)=>`${a} el ${b}`},it:{locale:"it-IT",legend:{less:"Meno",more:"Pi\xF9"},weekdays:["Dom","Lun","Mar","Mer","Gio","Ven","Sab"],tooltip:(a,b)=>`${a} il ${b}`}},v={en:"en","en-us":"en","en-gb":"en",english:"en",zh:"zh-cn","zh-cn":"zh-cn","zh-hans":"zh-cn","zh-sg":"zh-cn","zh-tw":"zh-tw","zh-hant":"zh-tw","zh-hk":"zh-tw",ja:"ja","ja-jp":"ja",japanese:"ja",fr:"fr","fr-fr":"fr",french:"fr",de:"de","de-de":"de",german:"de",ko:"ko","ko-kr":"ko",korean:"ko",es:"es","es-es":"es",spanish:"es",it:"it","it-it":"it",italian:"it"};class w{constructor(a,b=[],c={}){if("undefined"==typeof document)throw new Error("CalendarHeatmap: browser environment required.");this.container=d(a),this.options=Object.assign({},t,c),this.data=g(b),this.tooltipDisposer=null,e(),this.render()}setOptions(a={}){this.options=Object.assign({},this.options,a),e(),this.render()}setData(a=[]){this.data=g(a),this.render()}replaceData(a=[]){this.setData(a)}render(){var d=Math.floor;const{dates:e,start:g,end:h}=k(this.options.view,this.options),i=c(this.options.language||this.options.locale),j=this.options.locale||i.locale||void 0;let r;try{r=new Intl.DateTimeFormat(j,{dateStyle:"medium"})}catch(a){r=new Intl.DateTimeFormat(j,{month:"short",day:"numeric",year:"numeric"})}const s=Array.from(this.data.values()),t=null==this.options.maxValue?s.reduce((b,c)=>a(b,c),0):this.options.maxValue,v=document.createElement("div");v.className="ch-root",v.style.setProperty("--ch-size",`${this.options.squareSize}px`),v.style.setProperty("--ch-gap",`${this.options.squareGap}px`);const w=document.createElement("div");w.style.display="flex";const x=m(this.options,i,j);x&&w.appendChild(x);const y=document.createElement("div");y.className="ch-grid";let z=[],A=null;const B="year"===this.options.view,C=new Date,D=this.options.weekStart%7;for(let a=0;a<e.length;a+=1){const b=e[a],c=f(b);if(B&&c>f(C))break;const i=d(a/7);A!==i&&(z.length&&(y.appendChild(p(z)),z=[]),A=i);const j=this.data.get(c)||0,{color:k,level:m}=l(j,t,this.options.colorScale),n=(b.getDay()-D+7)%7,o=document.createElement("div");o.className="ch-day",o.style.backgroundColor=k,o.dataset.level=m+"",o.dataset.value=j+"",o.dataset.date=c,o.dataset.rangeStart=f(g),o.dataset.rangeEnd=f(h),o.title="",o.style.gridRowStart=n+1+"",z.push(o)}if(z.length&&y.appendChild(p(z)),w.appendChild(y),v.appendChild(w),"year"===this.options.view&&q(this.container,y),this.options.legend){const a=Object.assign({},u.en.legend,i.legend),b=n(this.options.colorScale,a);b&&v.appendChild(b)}if(this.container.innerHTML="",this.container.appendChild(v),this.tooltipDisposer&&(this.tooltipDisposer(),this.tooltipDisposer=null),this.options.tooltip){this.tooltipDisposer=o(v,a=>{const c=+a.value||0,d=new Date(a.date),e=b(d.getTime())?a.date:r.format(d);return i.tooltip?i.tooltip(c,e):u.en.tooltip(c,e)})}}destroy(){this.tooltipDisposer&&(this.tooltipDisposer(),this.tooltipDisposer=null),this.container.innerHTML=""}}return w.defaults=Object.assign({},t),w.languages=u,w});